<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>user admin</title>
    <link rel="stylesheet" type="text/css" href="css/Homepage.css" />
    <link rel="stylesheet" type="text/css" href="css/layui.css">
    <link rel="stylesheet" type="text/css" href="css/styles.css">

    <style>
        .main-table {
        width: 80%;
        float:left;
        margin-left: 1%;
    }

    [v-cloak] {
        display: none;
    }

    table {
        border: 1px solid;
    }

    table tr {
        height: 35px;
        line-height: 35px;
    }

    table tr,
    table tr td ,
    table th {
        border: 1px solid;
    }
    </style>
</head>

<body>
    <div id="userApp" v-cloak>
        <header class="site-header" style="margin-left:auto; margin-right: auto;max-width:70%;">
            <div class="masthead sticky-container" data-sticky-container="" style="height: 60px;">
                <div class="row expanded collapse">
                    <div class="masthead__column--left column">
                        <div class="row">
                            <div class="masthead__logo column">
                                <a href="home">
                                    <img alt="logo" title="logo" class="logo__light" src="images/25694.svg" height="42" width="42">
                                </a>
                            </div>
                            <div class="masthead__menu column">
                                <div ng-mega-menu="">
                                    <div ng-transclude="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="masthead__column--right column">
                        <div class="row--inline-flex">
                            <div class="masthead__subscription signUpBtn" style="border: 0px;">
                                <a href="Register.html">Sign up</a>
                            </div>
                            <div class="masthead__subscription loginBtn">
                                <a href="login.html">Login</a>
                            </div>
                            <div class="masthead__subscription welcomePanel">
                                <button id="welcomeText"></button>
                            </div>
                            <div class="masthead__subscription accountBtn">
                                <button onClick="location.href='UserLogs.html'">My Account</button>
                            </div>
                            <div class="masthead__subscription watchlistBtn">
                                <button onClick="location.href='Watchlist.html'">My Watchlist</button>
                            </div>
                            <div class="masthead__subscription staffBtn">
                                <button onClick="location.href='staffPortal.html'">Staff Portal</button>
                            </div>
                            <div class="masthead__subscription logoutBtn">
                                <button onClick="logOut()">Logout</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <div>
            <div style="width: 18%;float:left">
                <p>DOB: <input type="text" v-model="form.DOB"></p>
                <p>username: <input type="text" v-model="form.username"></p>
                <p>state: <input type="text" v-model="form.state"></p>
                <p>password: <input type="text" v-model="form.password"></p>
                <p>phone: <input type="text" v-model="form.phone"></p>
                <p>postcode: <input type="text" v-model="form.postcode"></p>
                <p>streetname: <input type="text" v-model="form.streetname"></p>
                <p>streetnumber: <input type="text" v-model="form.streetnumber"></p>
                <p>emailaddress: <input type="text" v-model="form.emailaddress"></p>
                <p>active: <input type="text" v-model="form.active"></p>
                <p>isadmin:
                    <select v-model="form.admin">
                        <option selected value="0">user</option>
                        <option value="1">admin</option>
                    </select>
                </p>
                <p><button @click="adduser()">add</button></p>
            </div>
            <div class="main-table">
                <table v-cloak>
                    <thead>
                        <th>ID</th>
                        <th>DOB</th>
                        <th>username</th>
                        <th>state</th>
                        <th>password</th>
                        <th>phone</th>
                        <th>postcode</th>
                        <th>streetname</th>
                        <th>streetnumber</th>
                        <th>userkey</th>
                        <th>emailaddress</th>
                        <th>isadmin</th>
                        <th>active</th>
                    </thead>
                    <tbody>
                        <tr :key="index" v-for="(item, index) in userlist">
                            <td>{{index+1}}</td>
                            <td>{{item.DOB}}</td>
                            <td>{{item.username}}</td>
                            <td>{{item.state}}</td>
                            <td>{{item.password}}</td>
                            <td>{{item.phone}}</td>
                            <td>{{item.postcode}}</td>
                            <td>{{item.streetname}}</td>
                            <td>{{item.streetnumber}}</td>
                            <td>{{item.userkey}}</td>
                            <td>{{item.emailaddress}}</td>
                            <td>{{item.admin}}</td>
                            <td>
                                <button @click="delItem(item)">del</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/6.4.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.4.0/firebase-database.js"></script>
    <script src='js/base.db.js'></script>
    <script src='js/vue.js'></script>
    <script>
    new Vue({
        el: '#userApp',
        data() {
            return {
                userlist: [],
                a: 6615,
                form: {
                    DOB: "",
                    username: "",
                    state: "",
                    password: "",
                    phone: "",
                    postcode: "",
                    streetname: "",
                    streetnumber: "",
                    emailaddress: "",
                    active: "",
                    admin: "0",
                }
            }
        },
        methods: {
            getAll: function(message) {
                db.ref('/Users').once('value').then(res => {
                    const users = []
                    res.forEach(user => {
                        users.push({
                            ...user.val(),
                            userkey: user.key
                        });
                    });
                    this.userlist = users
                })
            },
            delItem(row) {
                db.ref('/Users/' + row.userkey).remove(res => {
                    if (!res) {
                        this.getAll();
                    }
                })
            },
            adduser() {
                var fg = false;
                for (obj in this.form) {
                    if (!this.form[obj]) {
                        fg = true;
                    }
                }
                if (fg) {
                    alert("value not emty")
                    return false
                }
                db.ref('/Users').push(this.form).then(res => {
                    if (res.key) {
                        this.form = {}
                        this.getAll();
                    }
                })
            }
        },
        created() {
            this.getAll();
        }

    })
    </script>
</body>

</html>
